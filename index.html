<!DOCTYPE html>
<html>
<head>
  <title></title>
  <script src="lib/exim.js"></script>
</head>
<body>
  <script>
    var prev;
    var log = function(name) {
      var curr = Date.now(), diff;
      if (prev) {
        diff = curr - prev;
        prev = curr;
      } else {
        diff = 0;
        prev = curr;
      }
      console.log(name, '+', diff, 'ms');
    };
    window.store = Exim.createStore({
      actions: ['fetch'],
      initial: {
        items: [],
        fetching: false
      },
      fetch: {
        while: function(state) {
          console.log(state, 'whileStart');
          this.set('fetching', state);
          // Won't be executed. WTH?
          console.log(state, 'whileEnd');
        },
        will: function() {
          // console.log('will')
          return new Promise(function(res){
            setTimeout(res, 500, 'willResult');
          })
        },
        on: function() {
          this.set('test', 1)
          return new Promise(function(res){
            setTimeout(res, 500, 'onResult');
          })
        },
        did: function(data) {
          // console.log('did')
          return new Promise(function(res) {
            setTimeout(res, 500, 'didResult');
          });
        }
      }
    })
  </script>
</body>
</html>
